<!DOCTYPE html>
<html>
    <head>
        <script>
            var loaded = function loaded(el) {
                return console.log('loaded ' + el.href);
            };
            
            var revealCss = function revealCss(el) {
                el.onload = null;
                el.rel = 'stylesheet';
            };
        </script>
        <script src="/dist/polyfill.js"></script>
    </head>
    
    <body>
        <link rel="preload" as="style" href="foo.css" onload="loaded(this); revealCss(this)"/>
        <link rel="preload" as="script" href="foo.js" onload="loaded(this)" />
        <link rel="preload" as="script" href="foo.js" onload="loaded(this)" />
        <link rel="preload" as="script" href="bar.js" onload="loaded(this)" />
        <img src="img_fjords.jpg"/>
        
        <script src="/dist/invoke.js"></script>
        <!-- TODO resources are loaded twice once injecting them into the parent document ?WTF -->
    </body>
</html>